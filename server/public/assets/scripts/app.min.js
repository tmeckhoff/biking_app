/*! biking_app 2015-10-06 */
var myApp=angular.module("myApp",["ngRoute"]);console.log("In the app.js"),myApp.config(["$routeProvider",function(a){a.when("/home",{templateUrl:"/assets/views/routes/home.html",controller:"firstController"}).otherwise({redirectTo:"/home"})}]),myApp.controller("firstController",["$rootScope","$scope","$http",function(a,b,c){b.ratings=[],b.Rating=function(a,b,c,d,e,f,g){this.latitude=e,this.longitude=f,this.comment=d,this.name=a,this.title=b,this.rating=c,this.id=g},b.sendRating=function(){return b.showErrorMessage=!1,b.isMarkerSet()?c.post("/rating",{name:b.name,title:b.title,rating:b.rating,comment:b.comment,latitude:b.latitude,longitude:b.longitude}).success(function(a){b.name="",b.title="",b.rating="",b.comment="",b.successMessage="You rated it!",b.showSuccessMessage=!0,b.refreshRatings()}):(b.errorMessage="Please set a marker first",void(b.showErrorMessage=!0))},b.refreshRatings=function(){c.get("/rating").success(function(a){b.ratings=[];for(var c=0,d=a.length;d>c;c++)b.r=a[c],b.ratings.push(new b.Rating(b.r.name,b.r.title,b.r.rating,b.r.comment,b.r.latitude,b.r.longitude,b.r._id));return console.log(b.ratings),b.ratings.forEach(function(a,c){a.marker=new google.maps.Marker({draggable:!1,position:new google.maps.LatLng(a.latitude,a.longitude),map:b.map,icon:"../assets/styles/images/cycling.png"}),a.infowindow=new google.maps.InfoWindow({content:'<div class="info-box"><h5 class=info-header><b>'+a.name+"</b> said the following about this location:</h5><br/><h6>"+a.title+"</h6><br/><p>They rated it a: <br/><b>"+a.rating+"</b></p><br/><p><i>'"+a.comment+"'</i></p><br/></div>"}),google.maps.event.addListener(a.marker,"click",function(){a.infowindow.open(b.map,a.marker)})}),b.ratings})},a.$on("hideMessages",function(){b.$apply(function(){b.showSuccessMessage=!1,b.showErrorMessage=!1})}),b.refreshRatings(),b.map=new google.maps.Map(document.getElementById("map"),{zoom:13,center:{lat:44.970697,lng:-93.2614785},mapTypeId:google.maps.MapTypeId.ROADMAP});var d=[{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#444444"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2f2f2"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100},{lightness:45}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#46bcec"},{visibility:"on"}]}];b.map.setOptions({styles:d}),b.marker,google.maps.event.addListener(b.map,"click",function(c){b.marker=new google.maps.Marker({draggable:!1,position:c.latLng,map:b.map,animation:google.maps.Animation.DROP,icon:"../assets/styles/images/cycling.png"}),a.$broadcast("hideMessages"),b.latitude=b.marker.getPosition().lat(),b.longitude=b.marker.getPosition().lng()}),b.isMarkerSet=function(){return void 0===b.marker?!1:!0}}]);